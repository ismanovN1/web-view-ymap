<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yandex Map with Place Link on Click</title>
    <script src="https://api-maps.yandex.ru/v3/?apikey=0d85c950-dec2-47d5-903c-2c64cc4c973c&lang=ru_RU"
        type="text/javascript"></script>
    <style>
        #map {
            height: 100vh;
            width: 100%;
            margin: 0;
            padding: 0;
        }

        body,
        html {
            margin: 0;
            padding: 0;
            height: 100%;
        }
    </style>
</head>

<body>
    <div id="map"></div>

    <script type="text/javascript">
        const initMap = async () => {
            await ymaps3.ready;
            const center = [69.27969018961507, 41.31133298718927]
            const zoom = 13;
            const {
                YMap,
                YMapDefaultSchemeLayer,
                YMapControls,
                YMapDefaultFeaturesLayer,
                YMapMarker,
                YMapListener
            } = ymaps3;

            const {
                YMapDefaultMarker
            } = await ymaps3.import('@yandex/ymaps3-markers@0.0.1');

            const {
                YMapZoomControl,
                YMapGeolocationControl
            } = await ymaps3.import('@yandex/ymaps3-controls@0.0.1');
            const map = new YMap(document.getElementById('map'), {
                location: {
                    center: center,
                    zoom: zoom
                }
            });

            map.addChild(new YMapDefaultSchemeLayer());
            map.addChild(new YMapDefaultFeaturesLayer());

            let marker


            const click = (object, event) => {

                const coords = event.coordinates


                if (!marker) {
                    marker = new YMapDefaultMarker({
                        coordinates: coords,
                        color: '#00CC00'
                    })
                    map.addChild(marker);
                } else
                    marker.update({
                        coordinates: coords
                    });

                ymaps3.search({
                    'text': coords
                }).then(function (res) {
                    if (res[0]) {

                        const firstGeoObject = res[0]
                        const placeName = firstGeoObject.properties.name

                        // Generate Yandex Maps link
                        const yandexMapsLink =
                            `https://yandex.com/maps/?ll=${coords[1]},${coords[0]}&z=15`;


                        window.ReactNativeWebView.postMessage(
                            JSON.stringify({
                                type: "place_data",
                                payload: {
                                    coords,
                                    placeName,
                                    yandexMapsLink,
                                }
                            })
                        )
                    } else {
                        const yandexMapsLink =
                            `https://yandex.com/maps/?ll=${coords[1]},${coords[0]}&z=15`;
                        window.ReactNativeWebView.postMessage(
                            JSON.stringify({
                                type: "place_data",
                                payload: {
                                    coords,
                                    yandexMapsLink
                                }
                            })
                        )
                    }


                })
            }

            const mapListener = new YMapListener({
                layer: 'any',
                onFastClick: click,
                onClick: click,
            });
            map.addChild(mapListener);
        };
        initMap();
    </script>
</body>

</html>