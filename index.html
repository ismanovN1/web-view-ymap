<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yandex Map with Place Link on Click</title>
    <script src="https://api-maps.yandex.ru/2.1/?apikey=0d85c950-dec2-47d5-903c-2c64cc4c973c&lang=ru_RU"
        type="text/javascript"></script>
    <style>
        #map {
            height: 100vh;
            width: 100%;
        }
    </style>
</head>

<body>
    <div id="map"></div>

    <script type="text/javascript">
        ymaps.ready(init);

        function init() {
            // Initialize the Yandex map
            const map = new ymaps.Map('map', {
                center: [55.751244, 37.618423], // Default center (Moscow)
                zoom: 10
            });

            // Add click event listener to the map
            map.events.add('click', function (e) {
                const coords = e.get('coords');

                // Reverse geocoding to get the place name
                ymaps.geocode(coords).then(function (res) {
                    if (res.geoObjects.get(0)) {
                        const firstGeoObject = res.geoObjects.get(0);
                        const placeName = firstGeoObject.getAddressLine();

                        // Generate Yandex Maps link
                        const yandexMapsLink =
                            `https://yandex.com/maps/?ll=${coords[1]},${coords[0]}&z=15`;

                        window.ReactNativeWebView.postMessage(
                            JSON.stringify({
                                type: "place_data",
                                payload: {
                                    coords,
                                    placeName,
                                    yandexMapsLink,
                                }
                            })
                        )
                    } else {
                        window.ReactNativeWebView.postMessage(
                            JSON.stringify({
                                type: "place_data",
                                payload: {
                                    coords,
                                }
                            })
                        )
                    }
                }).catch(function (err) {
                    console.error('Geocoding failed: ', err);
                });
            });
        }
    </script>
</body>

</html>